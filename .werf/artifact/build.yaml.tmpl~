artifact: build
from: node:lts-alpine3.11
ansible:
  beforeInstall:
  install:
  - shell: npm install
    args:
      chdir: {{ .PROJECT_DIR_OUT }}
  - shell: npm config set unsafe-perm true && npm install -g @angular/cli npm-snapshot
    args:
      chdir: {{ .PROJECT_DIR_OUT }}
  - shell: ng build --output-path=deploy/admin-app --outputHashing=all --baseHref="https://stageadmin.magerya.ru" --configuration="staging"
    args:
      chdir: {{ .PROJECT_DIR_OUT }}
  beforeSetup:
  setup:
git:
- add: {{ .PROJECT_DIR_SRC }}
  to: {{ .PROJECT_DIR_OUT }}
  excludePaths:
    - "werf.yaml"
    - ".werf"
    - "bitbucket-pipelines.yml"
    - ".env.test"
    - ".git"
mount:
- from: build_dir
  to: /var/www/admin-panel/node_modules/
